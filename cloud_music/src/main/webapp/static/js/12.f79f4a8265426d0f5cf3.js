webpackJsonp([12],{"6zC6":function(t,e){},K5m8:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("0Qqk"),i=a("mx1b"),o={created:function(){this.id=this.$route.query.id},mounted:function(){this.getIntro(this.id)},components:{vHead:s.a,vFoot:i.a},computed:{state:function(){return this.$store.state}},data:function(){return{isfold:!0,id:"",flag:!1,img_change:!1,song:{id:"",name:"",artistId:"",artistName:"",language:"",style:"",albumId:"",albumName:"",duration:"",releaseDate:"",lyricsPath:"",filePath:"",image:""},editSong:{id:"",name:"",artistId:"",artistName:"",language:"",style:"",albumId:"",albumName:"",duration:"",releaseDate:"",lyricsPath:"",filePath:"",image:""},dialogVisible:!1,ruleForm:{name:"",des:""},rules:{name:[{required:!0,message:"请输入歌曲名称",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字符",trigger:"blur"}],artistName:[{required:!0,message:"请输入歌手名称",trigger:"blur"}],albumName:[{required:!0,message:"请输入专辑名称",trigger:"blur"}],language:[{required:!0,message:"请输入语种",trigger:"blur"}],style:[{required:!0,message:"请输入流派",trigger:"blur"}],releaseDate:[{required:!0,message:"请输入发行时间",trigger:"blur"}]},style:["","POP 流行","ELECTRONIC 电子","ROCK 摇滚","CLASSIC 古典","FOLK 民谣","R&B","其他"]}},methods:{deleteSong:function(){var t=this;this.$confirm("确认删除？").then(function(e){t.axios.get(t.serverUrl+"/song/removeSong",{params:{id:t.song.id}}).then(function(e){e?(t.$message({showClose:!0,message:"歌曲删除成功",type:"success"}),t.$router.go(-1)):t.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})}).catch(function(t){})},edit:function(){this.dialogVisible=!0,this.img_change=!1,this.editSong.id=this.song.id,this.editSong.name=this.song.name,this.editSong.artistId=this.song.artistId,this.editSong.artistName=this.song.artistName,this.editSong.language=this.song.language,this.editSong.style=this.song.style,this.editSong.albumId=this.song.albumId,this.editSong.albumName=this.song.albumName,this.editSong.duration=this.song.duration,this.editSong.releaseDate=this.song.releaseDate,this.editSong.lyricsPath=this.song.lyricsPath,this.editSong.filePath=this.song.filePath,this.editSong.image=this.song.image},finishEdit:function(t){var e=this;this.submitForm(t),this.flag&&(this.flag=!1,this.img_change&&this.$refs.upload.submit(),this.axios.post(this.$store.state.serverUrl+"/song/modifySong",{id:this.editSong.id,name:this.editSong.name,language:this.editSong.language,style:this.getStyleNumber(this.editSong.style),releaseDate:this.editSong.releaseDate}).then(function(t){var a=t.data;1==a?(alert("修改成功"),e.dialogVisible=!1,e.img_change||e.getIntro(e.id),e.img_change=!1):0==a&&alert("修改失败")}).catch(function(t){console.log(t)}))},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){return t?(e.flag=!0,!0):(console.log("error submit!!"),e.flag=!1,!1)})},getIntro:function(t){var e=this;this.axios.get(this.$store.state.serverUrl+"/song/getInfo",{params:{id:t}}).then(function(t){e.song=t.data,null==e.song.image?e.song.image="../../../assets/暂无图片.png":e.song.image=e.$store.state.serverUrl+e.song.image,e.song.lyricsPath=e.$store.state.serverUrl+e.song.lyricsPath,e.song.releaseDate=e.timestampToTime(e.song.releaseDate),e.song.style=e.style[e.song.style],e.axios.get(e.song.lyricsPath,{params:{}}).then(function(t){var e=t.data;document.getElementById("lyr").innerHTML=e.replace(/(\n)+|(\r\n)+/g,"<br>")}).catch(function(t){console.log(t)}),e.editSong.id=e.song.id,e.editSong.name=e.song.name,e.editSong.artistId=e.song.artistId,e.editSong.artistName=e.song.artistName,e.editSong.language=e.song.language,e.editSong.style=e.song.style,e.editSong.albumId=e.song.albumId,e.editSong.albumName=e.song.albumName,e.editSong.duration=e.song.duration,e.editSong.releaseDate=e.song.releaseDate,e.editSong.lyricsPath=e.song.lyricsPath,e.editSong.filePath=e.song.filePath,e.editSong.image=e.song.image}).catch(function(t){console.log(t)})},timestampToTime:function(t){var e=new Date(t),a=e.getFullYear()+"-",s=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",i=e.getDate();return i<10&&(i="0"+i),a+s+i},beforeAvatarUpload:function(t){var e=t.size/1024/1024<2;return e||this.$message.error("上传头像图片大小不能超过 2MB!"),e},handleAvatarSuccess:function(){this.getIntro(this.id)},previewImg:function(t,e){this.editSong.image=t.url,this.img_change=!0,e.length>1&&e.splice(0,1)},handleError:function(t){console.log(t),alert("上传失败")},handleLyrSuccess:function(){var t=this;this.$refs.uploadLyr.clearFiles(),this.axios.get(this.$store.state.serverUrl+"/song/getInfo",{params:{id:this.song.id}}).then(function(e){t.song.lyricsPath=t.$store.state.serverUrl+e.data.lyricsPath,t.axios.get(t.song.lyricsPath,{params:{}}).then(function(t){var e=t.data;document.getElementById("lyr").innerHTML=e.replace(/(\n)+|(\r\n)+/g,"<br>")}).catch(function(t){console.log(t)}),t.editSong.lyricsPath=t.song.lyricsPath,alert("上传成功")}).catch(function(t){console.log(t)})},uploadSongSuccess:function(){var t=this;this.$refs.uploadSong.clearFiles(),this.axios.get(this.$store.state.serverUrl+"/song/getInfo",{params:{id:this.song.id}}).then(function(e){t.song.filePath=t.$store.state.serverUrl+e.data.filePath,t.editSong.filePath=t.song.filePath,alert("上传成功")}).catch(function(t){console.log(t)})},getStyleNumber:function(t){for(var e=-1,a=0;a<this.style.length;a++)t==this.style[a]&&(e=a);return e}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},[a("v-head"),t._v(" "),a("div",{staticClass:"Asong_detail"},[a("el-row",{attrs:{gutter:50}},[a("el-col",{attrs:{span:4,offset:4}},[a("div",[a("img",{staticStyle:{"margin-top":"25px",height:"235px",width:"235px"},attrs:{align:"right",src:t.song.image}})])]),t._v(" "),a("el-col",{attrs:{span:9}},[a("div",[a("p",{staticClass:"font_songName",staticStyle:{"margin-bottom":"10px"}},[t._v(t._s(t.song.name))]),t._v(" "),a("i",{staticClass:"el-icon-service"}),t._v(" "),a("router-link",{attrs:{tag:"a",to:{path:"/admin/artistdetail",query:{id:t.song.artistId}}}},[a("span",{staticClass:"font_songArtist",staticStyle:{cursor:"pointer",color:"#2C3E50"},attrs:{onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='#2C3E50';"}},[t._v(t._s(t.song.artistName))])]),t._v(" "),a("div",[a("router-link",{attrs:{tag:"a",to:{path:"/admin/artistdetail",query:{id:t.song.artistId}}}},[a("p",{staticClass:"font_other",staticStyle:{float:"left",width:"250px",color:"#2C3E50",cursor:"pointer"},attrs:{onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='#2C3E50';"}},[t._v("专辑 : "+t._s(t.song.albumName))])]),t._v(" "),a("p",{staticClass:"font_other",staticStyle:{float:"left"}},[t._v("语种 : "+t._s(t.song.language))]),t._v(" "),a("div",{staticStyle:{clear:"both"}})],1),t._v(" "),a("div",[a("span",{staticClass:"font_other",staticStyle:{display:"block",width:"250px",float:"left"}},[t._v("流派 : "+t._s(t.song.style))]),t._v(" "),a("span",{staticClass:"font_other"},[t._v("发行时间 : "+t._s(t.song.releaseDate))])]),t._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{staticStyle:{"background-color":"#31C27C",display:"block",float:"left","margin-right":"10px"},attrs:{type:"primary",icon:"el-icon-edit",onmouseover:"this.style.backgroundColor='#2CAF6F';",onmouseout:"this.style.backgroundColor='#31C27C';"},on:{click:t.edit}},[t._v("编辑")]),t._v(" "),a("el-upload",{ref:"uploadSong",staticStyle:{height:"90px",float:"left","margin-right":"10px"},attrs:{action:"/hifive/upload/uploadSongFile",data:{id:this.song.id},"on-success":t.uploadSongSuccess,"on-error":t.handleError}},[a("el-button",{attrs:{slot:"trigger"},slot:"trigger"},[t._v("上传歌曲文件")])],1),t._v(" "),a("el-button",{attrs:{icon:"el-icon-delete"},on:{click:t.deleteSong}},[t._v("删除")])],1)],1)])],1),t._v(" "),a("el-row",{staticStyle:{"margin-top":"30px"},attrs:{gutter:50}},[a("el-col",{attrs:{span:8,offset:3}},[a("div",{staticStyle:{"margin-bottom":"30px"}},[a("p",{staticClass:"font_songLry",staticStyle:{"font-size":"20px"}},[t._v("歌词")]),t._v(" "),a("el-upload",{ref:"uploadLyr",staticClass:"lyr-uploader",attrs:{action:"/hifive/upload/uploadLyrics",data:{id:this.song.id},"on-success":t.handleLyrSuccess,"on-error":t.handleError}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("上传歌词")])],1),t._v(" "),a("div",{class:{fold:t.isfold},attrs:{id:"lyr"}}),t._v(" "),t.isfold?a("button",{staticStyle:{border:"0px","background-color":"transparent","margin-top":"10px",outline:"none",cursor:"pointer",color:"#31C27C"},on:{click:function(e){t.isfold=!1}}},[t._v("[展开]")]):t._e(),t._v(" "),t.isfold?t._e():a("button",{staticStyle:{border:"0px","background-color":"transparent","margin-top":"10px",outline:"none",cursor:"pointer",color:"#31C27C"},on:{click:function(e){t.isfold=!0}}},[t._v("[收起]")])],1)])],1),t._v(" "),a("el-dialog",{attrs:{title:"编辑歌曲信息",visible:t.dialogVisible,width:"40%",center:!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"editSong",attrs:{model:t.editSong,rules:t.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"歌名",prop:"name"}},[a("el-input",{model:{value:t.editSong.name,callback:function(e){t.$set(t.editSong,"name",e)},expression:"editSong.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"歌曲图片",prop:"image"}},[a("img",{staticClass:"avatar",staticStyle:{"margin-right":"20px"},attrs:{src:t.editSong.image}}),t._v(" "),a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{data:{id:t.editSong.id},"on-change":t.previewImg,action:"/hifive/upload/uploadSongImage","show-file-list":!1,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload,"on-error":t.handleError,accept:".jpg, .jpeg, png","auto-upload":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("点击更改图片")]),t._v(" "),a("div",[a("div",[t._v("图片大小不超过2M")]),t._v(" "),a("div",[t._v("上传图片格式为:jpg/jpeg/png")])])],1),t._v(" "),a("div",{staticStyle:{clear:"both"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"歌手名",prop:"artistName"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.editSong.artistName,callback:function(e){t.$set(t.editSong,"artistName",e)},expression:"editSong.artistName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"专辑",prop:"albumName"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.editSong.albumName,callback:function(e){t.$set(t.editSong,"albumName",e)},expression:"editSong.albumName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"语种",prop:"language"}},[a("el-input",{model:{value:t.editSong.language,callback:function(e){t.$set(t.editSong,"language",e)},expression:"editSong.language"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"流派",prop:"style"}},[a("el-select",{attrs:{placeholder:t.editSong.style},model:{value:t.editSong.style,callback:function(e){t.$set(t.editSong,"style",e)},expression:"editSong.style"}},[a("el-option",{attrs:{label:"POP 流行",value:"POP 流行"}}),t._v(" "),a("el-option",{attrs:{label:"ELECTRONIC 电子",value:"ELECTRONIC 电子"}}),t._v(" "),a("el-option",{attrs:{label:"ROCK 摇滚",value:"ROCK 摇滚"}}),t._v(" "),a("el-option",{attrs:{label:"CLASSIC 古典",value:"CLASSIC 古典"}}),t._v(" "),a("el-option",{attrs:{label:"FOLK 民谣",value:"FOLK 民谣"}}),t._v(" "),a("el-option",{attrs:{label:"R&B",value:"R&B"}}),t._v(" "),a("el-option",{attrs:{label:"其他",value:"其他"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"发行时间",prop:"releaseDate"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"请选择发行时间",format:"yyyy年 MM月 dd日","value-format":"yyyy-MM-dd"},model:{value:t.editSong.releaseDate,callback:function(e){t.$set(t.editSong,"releaseDate",e)},expression:"editSong.releaseDate"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.finishEdit("editSong")}}},[t._v("完成")]),t._v(" "),a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")])],1)],1)],1)],1),t._v(" "),a("v-foot")],1)},staticRenderFns:[]};var l=a("vSla")(o,n,!1,function(t){a("6zC6")},"data-v-2f82e35a",null);e.default=l.exports}});
//# sourceMappingURL=12.f79f4a8265426d0f5cf3.js.map