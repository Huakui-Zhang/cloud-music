webpackJsonp([13],{pyaF:function(t,e){},xm31:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("3cXf"),i=s.n(o),n=s("Hn+D"),a=s("ANMl"),l=s("mx1b"),r={created:function(){this.id=this.$route.query.id,window.scrollTo(0,0)},mounted:function(){this.isLogin=this.state.isLogin,this.getIntro(this.id)},components:{vHead:n.a,vNav:a.a,vFoot:l.a},computed:{state:function(){return this.$store.state},serverUrl:function(){return this.$store.state.serverUrl}},data:function(){return{isfold:!0,id:"",isLogin:"",song:{id:"",name:"",artistId:"",artistName:"",language:"",style:"",albumId:"",albumName:"",duration:"",releaseDate:"",lyricsPath:"",filePath:"",image:""},newPlaylist:{id:"",name:"",intro:"",type:"",info:""},playlistList:[],dialogVisible:!1,rules:{name:[{required:!0,message:"请输入歌单名称",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字符",trigger:"blur"}],intro:[{min:1,max:680,message:"长度在 680 个字符以内",trigger:"blur"}]},style:["","POP 流行","ELECTRONIC 电子","ROCK 摇滚","CLASSIC 古典","FOLK 民谣","R&B","其他"]}},methods:{playSong:function(){this.$store.dispatch("play",[this.song,0,!0])},collect:function(){var t=this;this.isLogin?this.axios.get(this.serverUrl+"/user/likeSong",{params:{songId:this.song.id}}).then(function(e){e?(t.state.likeSongs.push(t.song),t.song.isCollected=!0,sessionStorage.setItem("likeSongs",i()(t.$store.state.likeSongs)),t.$message({showClose:!0,message:"收藏歌曲成功",type:"success"})):t.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)}):this.$confirm("还未登录,是否现在登录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){t.$router.push({path:"/user/unlogin"})}).catch(function(){})},cancelCollect:function(){var t=this;this.axios.get(this.serverUrl+"/user/unlikeSong",{params:{songId:this.song.id}}).then(function(e){if(e){for(var s=0;s<t.state.likeSongs.length;s++)if(t.state.likeSongs[s].id==t.song.id){t.state.likeSongs.splice(s,1);break}t.song.isCollected=!1,t.$message({showClose:!0,message:"取消收藏成功",type:"success"})}else t.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})},handleSongCommand:function(t){"login"==t?this.$router.push({path:"/user/unlogin"}):"newplaylist"==t?(this.dialogVisible=!0,this.newPlaylist.type="song",this.newPlaylist.info=this.song.id):"playqueue"==t||this.addSongToPlaylist(t.params)},handleClose:function(t){this.$confirm("确认关闭？").then(function(e){t()}).catch(function(t){})},submitForm:function(t){var e=this;this.$refs.newPlaylist.validate(function(t){if(!t)return e.$message({showClose:!0,message:"格式不正确",type:"error"}),!1;e.axios.post(e.serverUrl+"/playlist/create",{name:e.newPlaylist.name,intro:e.newPlaylist.intro}).then(function(t){if(-1!=t.data){var s={id:t.data,name:e.newPlaylist.name,intro:e.newPlaylist.intro};e.state.playlistList.push(s),sessionStorage.setItem("playlistList",i()(e.$store.state.playlistList)),e.getPlaylistList(),e.dialogVisible=!1,e.$refs.newPlaylist.resetFields(),e.$message({showClose:!0,message:"歌单创建成功",type:"success"}),e.addSongToPlaylist(t.data)}else e.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})})},getIntro:function(t){var e=this;this.axios.get(this.serverUrl+"/song/getInfo",{params:{id:t}}).then(function(t){e.song=t.data,null==e.song.image?e.song.image="../../../assets/暂无图片.png":e.song.image=e.serverUrl+e.song.image,e.song.lyricsPath=e.serverUrl+e.song.lyricsPath,e.song.releaseDate=e.timestampToTime(e.song.releaseDate),e.song.filePath=e.serverUrl+e.song.filePath,e.song.style=e.style[e.song.style],e.$set(e.song,"isCollected",!1),e.getIsCollected(),e.axios.get(e.song.lyricsPath,{params:{}}).then(function(t){var e=t.data;document.getElementById("lyr").innerHTML=e.replace(/(\n)+|(\r\n)+/g,"<br>")}).catch(function(t){console.log(t)})}).catch(function(t){console.log(t)})},timestampToTime:function(t){var e=new Date(t),s=e.getFullYear()+"-",o=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",i=e.getDate();return i<10&&(i="0"+i),s+o+i},downloadSong:function(){var t=this;this.isLogin?window.location.href=this.serverUrl+"/download/downloadSong?id="+this.song.id:this.$confirm("还未登录,是否现在登录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){t.$router.push({path:"/user/unlogin"})}).catch(function(){})},getPlaylistList:function(){if(!this.isLogin)return!1;this.playlistList=this.state.playlistList},getIsCollected:function(){for(var t=!1,e=0;e<this.state.likeSongs.length;e++)if(this.song.id==this.state.likeSongs[e].id){t=!0;break}this.song.isCollected=t},addSongToPlaylist:function(t){var e=this;this.axios.get(this.serverUrl+"/playlist/addSong",{params:{songId:this.song.id,playlistId:t}}).then(function(t){t?e.$message({showClose:!0,message:"已成功添加到歌单",type:"success"}):e.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})}}},c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wrapper"},[s("v-head"),t._v(" "),s("v-nav"),t._v(" "),s("div",{staticClass:"song_detail"},[s("el-row",{staticStyle:{background:"linear-gradient(#F2F2F2, #FFFFFF)"},attrs:{gutter:50}},[s("el-col",{attrs:{span:4,offset:4}},[s("div",[s("img",{staticStyle:{"margin-top":"25px",height:"235px",width:"235px"},attrs:{align:"right",src:t.song.image}})])]),t._v(" "),s("el-col",{attrs:{span:12}},[s("div",[s("p",{staticClass:"font_songName",staticStyle:{"margin-bottom":"10px"}},[t._v(t._s(t.song.name))]),t._v(" "),s("i",{staticClass:"el-icon-service"}),t._v(" "),s("router-link",{attrs:{tag:"a",to:{path:"/user/artistdetail",query:{id:t.song.artistId}}}},[s("span",{staticClass:"font_songArtist",staticStyle:{cursor:"pointer",color:"#2C3E50"},attrs:{onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='#2C3E50';"}},[t._v(t._s(t.song.artistName))])]),t._v(" "),s("div",[s("router-link",{attrs:{tag:"a",to:{path:"/user/artistdetail",query:{id:t.song.artistId}}}},[s("p",{staticClass:"font_other",staticStyle:{float:"left",width:"250px",color:"#2C3E50",cursor:"pointer"},attrs:{onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='#2C3E50';"}},[t._v("专辑 : "+t._s(t.song.albumName))])]),t._v(" "),s("p",{staticClass:"font_other",staticStyle:{float:"left"}},[t._v("语种 : "+t._s(t.song.language))]),t._v(" "),s("div",{staticStyle:{clear:"both"}})],1),t._v(" "),s("div",[s("span",{staticClass:"font_other",staticStyle:{display:"block",width:"250px",float:"left"}},[t._v("流派 : "+t._s(t.song.style))]),t._v(" "),s("span",{staticClass:"font_other"},[t._v("发行时间 : "+t._s(t.song.releaseDate))])]),t._v(" "),s("div",{staticStyle:{"margin-top":"20px"}},[s("el-button",{staticStyle:{"background-color":"#31C27C"},attrs:{type:"primary",icon:"el-icon-caret-right",onmouseover:"this.style.backgroundColor='#2CAF6F';",onmouseout:"this.style.backgroundColor='#31C27C';"},on:{click:t.playSong}},[t._v("播放")]),t._v(" "),t.song.isCollected?s("el-button",{attrs:{icon:"el-icon-star-on"},on:{click:t.cancelCollect}},[t._v("已收藏")]):s("el-button",{attrs:{icon:"el-icon-star-off"},on:{click:t.collect}},[t._v("收藏")]),t._v(" "),s("el-button",{attrs:{icon:"el-icon-download"},on:{click:t.downloadSong}},[t._v("下载")]),t._v(" "),s("el-dropdown",{attrs:{trigger:"click",id:"dropdown"},on:{command:t.handleSongCommand}},[s("el-button",{attrs:{icon:"el-icon-plus"},on:{click:t.getPlaylistList}},[t._v("添加到"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown",data:t.playlistList},slot:"dropdown"},[s("el-dropdown-item",{attrs:{command:"playqueue"}},[t._v("播放队列")]),t._v(" "),t.isLogin?s("div",[t._l(t.playlistList,function(e){return s("el-dropdown-item",{key:e.id,attrs:{command:{type:"playlist",params:e.id}}},[t._v(t._s(e.name))])}),t._v(" "),s("el-dropdown-item",{attrs:{command:"newplaylist",divided:""}},[t._v("添加到新歌单")])],2):s("el-dropdown-item",{attrs:{command:"login",divided:""}},[t._v("登录后添加到歌单")])],1)],1),t._v(" "),s("el-dialog",{attrs:{title:"创建歌单",visible:t.dialogVisible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("el-form",{ref:"newPlaylist",attrs:{model:t.newPlaylist,rules:t.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"歌单名称",prop:"name"}},[s("el-input",{attrs:{placeholder:"请输入歌单名称"},model:{value:t.newPlaylist.name,callback:function(e){t.$set(t.newPlaylist,"name",e)},expression:"newPlaylist.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"歌单简介",prop:"intro"}},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入歌单简介"},model:{value:t.newPlaylist.intro,callback:function(e){t.$set(t.newPlaylist,"intro",e)},expression:"newPlaylist.intro"}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("完成")]),t._v(" "),s("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")])],1)],1)],1)],1)],1)])],1),t._v(" "),s("el-row",{staticStyle:{"margin-top":"30px"},attrs:{gutter:50}},[s("el-col",{attrs:{span:8,offset:3}},[s("div",{staticStyle:{"margin-bottom":"30px"}},[s("p",{staticClass:"font_songLry",staticStyle:{"font-size":"20px"}},[t._v("歌词")]),t._v(" "),s("div",{class:{fold:t.isfold},attrs:{id:"lyr"}}),t._v(" "),t.isfold?s("button",{staticStyle:{border:"0px","background-color":"transparent","margin-top":"10px",outline:"none",cursor:"pointer",color:"#31C27C"},on:{click:function(e){t.isfold=!1}}},[t._v("[展开]")]):t._e(),t._v(" "),t.isfold?t._e():s("button",{staticStyle:{border:"0px","background-color":"transparent","margin-top":"10px",outline:"none",cursor:"pointer",color:"#31C27C"},on:{click:function(e){t.isfold=!0}}},[t._v("[收起]")])])])],1)],1),t._v(" "),s("v-foot")],1)},staticRenderFns:[]};var g=s("vSla")(r,c,!1,function(t){s("pyaF")},"data-v-2cdfdf21",null);e.default=g.exports}});
//# sourceMappingURL=13.8df006d66b418f0c088e.js.map