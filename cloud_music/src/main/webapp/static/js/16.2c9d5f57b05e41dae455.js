webpackJsonp([16],{"03dp":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=i("3cXf"),s=i.n(l),a=i("Hn+D"),o=(i("ANMl"),i("mx1b")),n=i("T0cg"),r=i.n(n),c={components:{vHeader:a.a,vFoot:o.a},data:function(){return{id:"",playlist:{},index:1,songsView:[],playlistSongList:[],isOverflow:"",dialogVisible:!1,editDialogVisible:!1,dialogImageUrl:"",notDelete:!1,page:1,pageCount:1,rules:{name:[{required:!0,message:"请输入歌单名称",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],intro:[{min:1,max:680,message:"长度在 680 个字符以内",trigger:"blur"}]},newPlaylist:{id:"",name:"",intro:"",type:"",info:""},ruleForm:{id:"",name:"",intro:"",image:""},playlistList:[],hasChangeImage:!1}},computed:{serverUrl:function(){return this.$store.state.serverUrl},isLogin:function(){return this.$store.state.isLogin}},created:function(){window.scrollTo(0,0),this.id=this.$route.query.id},mounted:function(){this.getPlaylistIntro(),this.pagination(1),this.computePageCount(),this.getPlaylistList()},updated:function(){this.handleOverflow()},methods:{indexMethod:function(t){return 20*(this.page-1)+t+1},handleOverflow:function(){var t=document.getElementById("playlistIntro").offsetWidth,e=document.getElementById("playlistIntro").scrollWidth;this.isOverflow=t<e},playAllSong:function(){this.$store.dispatch("play",[this.playlistSongList,0,!1])},handlePlaylistCommand:function(t){"login"==t.type?window.location.href="/":"newplaylist"==t.type?(this.dialogVisible=!0,this.newPlaylist.type="playlist"):"playqueue"==t.type?this.addAllToSongList():this.addPlaylistToPlaylist(t.param1)},addPlaylistToPlaylist:function(t){var e=this;this.axios.get(this.serverUrl+"/playlist/addPlaylistToPlaylist",{params:{fromId:this.playlist.id,toId:t}}).then(function(t){t?(e.getPlaylistList(),e.$message({showClose:!0,message:"已成功添加到歌单",type:"success"})):e.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})},handleMouseEnter:function(t,e,i,l){t.Flag=!0},handleMouseOut:function(t,e,i,l){if(t.isopen)return!1;t.Flag=!1},handle:function(t,e){t.Flag=e,t.isopen=e},handleSongCommand:function(t){"login"==t.type?window.location.href="/":"newplaylist"==t.type?(this.dialogVisible=!0,this.newPlaylist.type="song",this.newPlaylist.info=t.params.id):"playqueue"==t.type||this.addSongToPlaylist(t.param2.id,t.param1)},addSongToPlaylist:function(t,e){var i=this;this.axios.get(this.serverUrl+"/playlist/addSong",{params:{songId:t,playlistId:e}}).then(function(t){t?i.$message({showClose:!0,message:"已成功添加到歌单",type:"success"}):i.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})},handleClose:function(t){this.$confirm("确认关闭？").then(function(e){t()}).catch(function(t){})},downloadSong:function(t){this.isLogin?window.location.href=this.serverUrl+"/download/downloadSong?id="+t.id:this.$confirm("还未登录,是否现在登录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){window.location.href="/"}).catch(function(){})},getPlaylistList:function(){if(!this.isLogin)return!1;this.playlistList=this.$store.state.playlistList},getPlaylistIntro:function(){var t=this;this.axios.get(this.serverUrl+"/playlist/getInfo",{params:{id:this.id}}).then(function(e){console.log(e.data),t.playlist=e.data,null==t.playlist.image?t.playlist.image=r.a:t.playlist.image=t.serverUrl+t.playlist.image,null==t.playlist.intro&&(t.playlist.intro=" "),t.playlistSongList=t.playlist.songList;for(var i=0;i<t.playlistSongList.length;i++)t.playlistSongList[i].filePath=t.serverUrl+t.playlistSongList[i].filePath,t.playlistSongList[i].image=t.serverUrl+t.playlistSongList[i].image,t.playlistSongList[i].lyricsPath=t.serverUrl+t.playlistSongList[i].lyricsPath,t.$set(t.playlistSongList[i],"Flag",!1),t.$set(t.playlistSongList[i],"isopen",!1);t.computePageCount(),t.pagination(1)}).catch(function(t){console.log(t)})},submitForm:function(){var t=this;this.$refs.ruleForm.validate(function(e){if(!e)return t.$message({showClose:!0,message:"格式不正确",type:"error"}),!1;t.hasChangeImage&&t.$nextTick(function(){t.$refs.uploadImage.submit()}),t.axios.post(t.serverUrl+"/playlist/modifyInfo",{id:t.ruleForm.id,name:t.ruleForm.name,intro:t.ruleForm.intro}).then(function(e){e?(t.$refs.ruleForm.resetFields(),t.hasChangeImage||t.getPlaylistIntro(),t.handleOverflow(),t.editDialogVisible=!1,t.$message({showClose:!0,message:"歌单编辑成功",type:"success"}),t.hasChangeImage=!1):t.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})})},handleChange:function(t){t!=this.page&&this.pagination(t)},pagination:function(t){this.page=t,this.songsView.splice(0,this.songsView.length);for(var e=0;e<20;e++)if(null==this.playlistSongList[20*(t-1)+e]);else{var i=this.playlistSongList[20*(t-1)+e];this.songsView.push(i)}},computePageCount:function(){this.pageCount=Math.ceil(parseFloat(this.playlistSongList.length)/20)},addAllToSongList:function(){this.$store.dispatch("addToSongList",this.playlistSongList)},addToSongList:function(t){t=20*(this.page-1)+t;var e=[this.playlistSongList[t]];this.$store.dispatch("addToSongList",e)},playSong:function(t){var e=20*(this.page-1)+t;this.$store.dispatch("play",[this.playlistSongList,e,!1])},deleteSong:function(t,e){var i=this;this.axios.get(this.serverUrl+"/playlist/removeSong",{params:{songId:t.id,playlistId:this.playlist.id}}).then(function(t){t?(i.playlistSongList.splice(20*(i.page-1)+e,1),i.pagination(i.page),i.$message({showClose:!0,message:"歌曲移出歌单",type:"success"})):i.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})},editImage:function(t,e){this.beforeAvatarUpload(t)?(this.ruleForm.image=t.url,this.hasChangeImage=!0,e.length>1&&e.splice(0,1)):e.splice(e.length-1,1)},handleAvatarSuccess:function(){this.getPlaylistIntro(),alert("上传成功"),this.hasChangeImage=!1},beforeAvatarUpload:function(t){var e="image/jpg"===t.type||"image/jpeg",i=t.size/1024/1024<2;return e||this.$message.error("上传图片只能是jpg/jpeg/png格式!"),i||this.$message.error("上传歌单封面大小不能超过 2MB!"),e&&i},createPlaylist:function(){var t=this;this.$refs.newPlaylist.validate(function(e){if(!e)return t.$message({showClose:!0,message:"格式不正确",type:"error"}),!1;t.axios.post(t.serverUrl+"/playlist/create",{name:t.newPlaylist.name,intro:t.newPlaylist.intro}).then(function(e){if(-1!=e.data){var i={id:e.data,name:t.newPlaylist.name,intro:t.newPlaylist.intro};if(t.$store.state.playlistList.push(i),sessionStorage.setItem("playlistList",s()(t.state.playlistList)),t.getPlaylistList(),t.dialogVisible=!1,t.$refs.newPlaylist.resetFields(),t.$message({showClose:!0,message:"歌单创建成功",type:"success"}),"song"==t.newPlaylist.type)t.addSongToPlaylist(t.newPlaylist.info,e.data);else if("playlist"==t.newPlaylist.type)t.addPlaylistToPlaylist(e.data);else if(""==t.newPlaylist.type)return!1}else t.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})})},clickOnEdit:function(){this.ruleForm.id=this.playlist.id,this.ruleForm.name=this.playlist.name,this.ruleForm.intro=this.playlist.intro,this.playlist.image!=r.a&&(this.ruleForm.image=this.playlist.image)},cancelEdit:function(t){var e=this;this.$confirm("确认关闭？").then(function(i){e.clickOnEdit(),e.editDialogVisible=!1,t()}).catch(function(t){})},uploadFail:function(t,e,i){alert("上传失败")}}},d={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("v-header"),t._v(" "),i("div",{staticClass:"playlistDetail",attrs:{data:t.playlist}},[i("el-row",[i("div",{staticClass:"playlistInfo"},[i("el-col",{attrs:{span:5,offset:4}},[i("div",[i("img",{staticStyle:{width:"230px",height:"230px","margin-top":"20px"},attrs:{src:t.playlist.image,onerror:"this.style.display='none'"}})])]),t._v(" "),i("el-col",{attrs:{span:10}},[i("div",[i("div",{staticClass:"intro"},[i("h2",[t._v(t._s(t.playlist.name))]),t._v(" "),i("p",[t._v("简介")]),t._v(" "),i("p",{staticStyle:{width:"500px",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":"1",overflow:"hidden",float:"left","margin-top":"0px"},attrs:{id:"playlistIntro"}},[t._v(t._s(t.playlist.intro))]),t._v(" "),this.isOverflow?i("el-popover",{staticStyle:{float:"left"},attrs:{placement:"left",title:"简介",trigger:"click"}},[i("p",{staticClass:"font_des",staticStyle:{width:"600px"}},[t._v(t._s(t.playlist.intro))]),t._v(" "),i("el-button",{staticStyle:{color:"black","margin-left":"20px","padding-top":"15px"},attrs:{slot:"reference",type:"text",onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='black';"},slot:"reference"},[t._v("[更多]")])],1):t._e()],1),t._v(" "),i("el-button",{staticClass:"btn2",attrs:{type:"primary",icon:"el-icon-caret-right"},on:{click:t.playAllSong}},[t._v("播放全部")]),t._v(" "),i("el-popover",{ref:"",attrs:{placement:"right",width:"500",trigger:"click"},model:{value:t.editDialogVisible,callback:function(e){t.editDialogVisible=e},expression:"editDialogVisible"}},[i("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"歌单名称",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入歌单名称"},model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"歌单简介",prop:"intro"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入歌单简介"},model:{value:t.ruleForm.intro,callback:function(e){t.$set(t.ruleForm,"intro",e)},expression:"ruleForm.intro"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"上传图片",prop:"image"}},[i("el-upload",{ref:"uploadImage",staticClass:"avatar-uploader",attrs:{action:"/hifive/upload/uploadPlaylistImage","auto-upload":!1,"list-type":"picture-card","show-file-list":!1,data:{id:t.ruleForm.id},"on-change":t.editImage,"on-success":t.handleAvatarSuccess,"on-error":t.uploadFail,accept:".jpg, .jpeg, .png"}},[t.ruleForm.image?i("img",{staticStyle:{width:"150px",height:"150px"},attrs:{src:t.ruleForm.image,alt:""}}):i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("完成")]),t._v(" "),i("el-button",{on:{click:t.cancelEdit}},[t._v("取消")])],1)],1),t._v(" "),i("el-button",{staticClass:"btn2",attrs:{slot:"reference"},on:{click:t.clickOnEdit},slot:"reference"},[t._v("编辑歌单")])],1),t._v(" "),i("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handlePlaylistCommand}},[i("el-button",{staticClass:"btn2",attrs:{icon:"el-icon-plus"}},[t._v("添加到"),i("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown",data:t.playlistList},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:{type:"playqueue"}}},[t._v("播放队列")]),t._v(" "),t.isLogin?i("div",[t._l(t.playlistList,function(e){return i("el-dropdown-item",{key:e.id,attrs:{command:{type:"playlist",param1:e.id}}},[t._v(t._s(e.name))])}),t._v(" "),i("el-dropdown-item",{attrs:{command:{type:"newplaylist"},divided:""}},[t._v("添加到新歌单")])],2):i("el-dropdown-item",{attrs:{command:{type:"login"},divided:""}},[t._v("登录后添加到歌单")])],1)],1)],1)])],1)]),t._v(" "),i("el-row",[i("el-col",{attrs:{span:15.5,offset:4}},[i("div",{staticClass:"playlistSongList"},[i("el-table",{staticClass:"songTable",attrs:{data:t.songsView,"max-height":"1350"},on:{"cell-mouse-enter":t.handleMouseEnter,"cell-mouse-leave":t.handleMouseOut}},[i("el-table-column",{attrs:{type:"index",label:" ",index:t.indexMethod}}),t._v(" "),i("el-table-column",{attrs:{label:"歌曲",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("router-link",{attrs:{to:{path:"/user/songdetail",query:{id:t.playlistSongList[e.$index].id}}}},[i("el-button",{staticStyle:{color:"black",cursor:"pointer","text-decoration":"none"},attrs:{type:"text",onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='black';"}},[t._v(t._s(e.row.name))])],1)]}}])}),t._v(" "),i("el-table-column",{attrs:{label:" ",width:"200",type:"index"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.Flag?i("span",[i("el-button",{attrs:{icon:"el-icon-caret-right",circle:""},on:{click:function(i){t.playSong(e.$index)}}})],1):t._e(),t._v(" "),e.row.Flag?i("span",[i("el-dropdown",{attrs:{trigger:"click",placement:"bottom-start"},on:{"visible-change":function(i){t.handle(e.row,i)},command:t.handleSongCommand}},[i("el-button",{attrs:{icon:"el-icon-plus",circle:""}}),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown",data:t.playlistList},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:{type:"playqueue"}},nativeOn:{click:function(i){t.addToSongList(e.$index)}}},[t._v("播放队列")]),t._v(" "),t.isLogin?i("div",[t._l(t.playlistList,function(l){return i("el-dropdown-item",{key:l.id,attrs:{command:{type:"playlist",param1:l.id,param2:e.row}}},[t._v(t._s(l.name))])}),t._v(" "),i("el-dropdown-item",{attrs:{command:{type:"newplaylist",params:e.row},divided:""}},[t._v("添加到新歌单")])],2):i("el-dropdown-item",{attrs:{command:{type:"login"},divided:""}},[t._v("登录后添加到歌单")])],1)],1)],1):t._e(),t._v(" "),i("el-dialog",{attrs:{title:"创建歌单",visible:t.dialogVisible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{ref:"newPlaylist",attrs:{model:t.newPlaylist,rules:t.rules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"歌单名称",prop:"name"}},[i("el-input",{attrs:{placeholder:"请输入歌单名称"},model:{value:t.newPlaylist.name,callback:function(e){t.$set(t.newPlaylist,"name",e)},expression:"newPlaylist.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"歌单简介",prop:"intro"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入歌单简介"},model:{value:t.newPlaylist.intro,callback:function(e){t.$set(t.newPlaylist,"intro",e)},expression:"newPlaylist.intro"}})],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.createPlaylist}},[t._v("完成")]),t._v(" "),i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")])],1)],1)],1),t._v(" "),e.row.Flag?i("span",[i("el-button",{attrs:{icon:"el-icon-download",circle:""},on:{click:function(i){t.downloadSong(e.row)}}})],1):t._e()]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"歌手",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("router-link",{attrs:{to:{path:"/user/artistdetail",query:{id:t.playlistSongList[e.$index].artistId}}}},[i("el-button",{staticStyle:{color:"black",cursor:"pointer","text-decoration":"none"},attrs:{type:"text",onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='black';"}},[t._v(t._s(e.row.artistName))])],1)]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"专辑",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("router-link",{attrs:{to:{path:"/user/albumdetail",query:{id:e.row.albumId}}}},[i("el-button",{staticStyle:{color:"black",cursor:"pointer","text-decoration":"none"},attrs:{type:"text",onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='black';"}},[t._v(t._s(e.row.albumName))])],1)]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"时长"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.Flag?i("span",[i("el-button",{attrs:{icon:"el-icon-delete",circle:""},on:{click:function(i){t.deleteSong(e.row,e.$index)}}})],1):i("span",{staticClass:"font_other"},[t._v(t._s(e.row.duration))])]}}])})],1),t._v(" "),i("br"),t._v(" "),i("br")],1)])],1),t._v(" "),i("el-row",[i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:15,offset:4}},[i("el-pagination",{staticClass:"pagination",attrs:{"page-count":t.pageCount,layout:"prev, pager, next"},on:{"current-change":t.handleChange}})],1)],1)],1),t._v(" "),i("v-foot")],1)},staticRenderFns:[]};var p=i("vSla")(c,d,!1,function(t){i("U9u9")},"data-v-18bfc5ff",null);e.default=p.exports},U9u9:function(t,e){}});
//# sourceMappingURL=16.2c9d5f57b05e41dae455.js.map