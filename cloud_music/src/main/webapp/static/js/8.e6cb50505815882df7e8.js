webpackJsonp([8],{"1TSA":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={components:{vFoot:s("mx1b").a},data:function(){var e=this;return{active:0,flag:"false",email:{id:""},security:{securityQuestion:"",securityAnswer:""},password:{newPwd:"",confirmedNewPwd:""},rules1:{id:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}]},rules2:{securityQuestion:[{required:!0}],securityAnswer:[{required:!0,message:"请输入答案",trigger:["blur","change"]}]},rules3:{newPwd:[{required:!0,validator:function(e,t,s){""===t?s(new Error("请输入密码")):/^(?=.*?[A-Za-z])(?=.*?[0-9]).{6,20}$/.test(t)?s():s(new Error("输入密码要6-20位,要包含字母和数字"))},trigger:["blur","change"]}],confirmedNewPwd:[{required:!0,validator:function(t,s,i){""===s?i(new Error("请再次输入密码")):s!==e.password.newPwd?i(new Error("两次输入密码不一致!")):i()},trigger:["blur","change"]}]}}},computed:{serverUrl:function(){return this.$store.state.serverUrl},state:function(){return this.$store.state}},methods:{next:function(){0==this.active&&this.checkUserExisted(this.email.id),1==this.active&&this.checkAnswer(this.email.id,this.security.securityAnswer),2==this.active&&this.resetPassword(this.password.newPwd)},last:function(){this.active--<1&&(this.active=0),this.hidden(this.active)},hidden:function(e){0==e?(document.getElementById("div1").style.display="block",document.getElementById("div2").style.display="none",document.getElementById("div3").style.display="none"):1==e?(document.getElementById("div2").style.display="block",document.getElementById("div1").style.display="none",document.getElementById("div3").style.display="none"):2==e?(document.getElementById("div3").style.display="block",document.getElementById("div1").style.display="none",document.getElementById("div2").style.display="none"):3==e&&this.$router.push({path:"/user/unlogin"})},checkUserExisted:function(e){var t=this;this.checkInput("email"),this.flag?(this.flag=!1,this.axios.get(this.serverUrl+"/user/checkUserExisted",{params:{id:e}}).then(function(e){e.data||(t.$message({message:"用户不存在！",type:"error"}),t.active=-1),t.active++>2&&(t.active=3),t.hidden(t.active);var s=t.email.id;t.getQuestion(s)}).catch(function(e){console.log(e)})):this.active=0},getQuestion:function(e){var t=this;this.axios.get(this.serverUrl+"/user/getQuestion",{params:{id:e}}).then(function(e){1==e.data?t.security.securityQuestion="你的家乡在哪里":2==e.data?t.security.securityQuestion="你的父亲名字？":3==e.data?t.security.securityQuestion="你的母亲名字？":4==e.data&&(t.security.securityQuestion="你的生日？")}).catch(function(e){console.log(e)})},checkAnswer:function(e,t){var s=this;this.checkInput("security"),this.flag?(this.flag=!1,this.axios.post(this.$store.state.serverUrl+"/user/checkAnswer",{id:e,securityAnswer:t}).then(function(e){e.data||(s.$message({message:"答案错误！",type:"error"}),s.active=0),s.active++>2&&(s.active=3),s.hidden(s.active)}).catch(function(e){console.log(e)})):this.active=1},resetPassword:function(e){var t=this;this.checkInput("password"),this.flag?(this.flag=!1,this.axios.post(this.$store.state.serverUrl+"/user/resetPassword",{newPwd:e}).then(function(e){e.data?t.$message({message:"密码修改成功！",type:"success"}):t.$message({message:"密码修改失败！",type:"error"}),t.active++>2&&(t.active=3),t.hidden(t.active)}).catch(function(e){console.log(e)})):this.active=2},checkInput:function(e){var t=this;this.$refs[e].validate(function(e){return e?(t.flag=!0,!0):(console.log("error submit!!"),t.flag=!1,!1)})}}},r={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"main"},[s("div",{staticClass:"Nav"},[s("div",{staticClass:"NavMenu"},[s("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[s("div",{staticStyle:{margin:"2% 25%"}},[s("el-breadcrumb-item",{staticStyle:{"font-size":"25px","font-family":"Microsoft YaHei"},attrs:{to:{path:"/"}}},[e._v("云音乐网站")]),e._v(" "),s("el-breadcrumb-item",{staticStyle:{"margin-top":"4px","font-size":"20px","font-family":"Microsoft YaHei"}},[e._v("找回密码")])],1)])],1)]),e._v(" "),s("div",{staticClass:"Steps"},[s("el-steps",{attrs:{active:e.active,"finish-status":"success","align-center":""}},[s("el-step",{attrs:{title:"填写邮箱",icon:"el-icon-edit"}}),e._v(" "),s("el-step",{attrs:{title:"密保问题",icon:"el-icon-question"}}),e._v(" "),s("el-step",{attrs:{title:"重置密码",icon:"el-icon-refresh"}})],1)],1),e._v(" "),s("div",{staticClass:"Step"},[[s("div",{staticStyle:{width:"400px",height:"50px",margin:"auto",display:"block"},attrs:{id:"div1"}},[s("el-form",{ref:"email",attrs:{model:e.email,rules:e.rules1,"label-width":"85px"}},[s("el-form-item",{attrs:{label:"邮箱",prop:"id"}},[s("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入邮箱","prefix-icon":"el-icon-search",clearable:""},model:{value:e.email.id,callback:function(t){e.$set(e.email,"id",t)},expression:"email.id"}})],1)],1)],1),e._v(" "),s("div",{staticStyle:{width:"400px",height:"100px",margin:"auto",display:"none"},attrs:{id:"div2"}},[s("el-form",{ref:"security",attrs:{model:e.security,rules:e.rules2}},[s("el-form-item",{attrs:{label:"密保问题：",prop:"securityQuestion"}},[s("li",{staticStyle:{"list-style-type":"none"}},[e._v(e._s(e.security.securityQuestion))])]),e._v(" "),s("el-form-item",{attrs:{label:"密保答案：",prop:"securityAnswer"}},[s("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入答案",clearable:""},model:{value:e.security.securityAnswer,callback:function(t){e.$set(e.security,"securityAnswer",t)},expression:"security.securityAnswer"}})],1)],1)],1),e._v(" "),s("div",{staticStyle:{width:"400px",height:"100px",margin:"auto",display:"none"},attrs:{id:"div3"}},[s("el-form",{ref:"password",attrs:{model:e.password,rules:e.rules3}},[s("el-form-item",{attrs:{label:"新密码：",prop:"newPwd"}},[s("el-input",{staticStyle:{width:"300px",float:"right"},attrs:{placeholder:"请输入新密码",clearable:""},model:{value:e.password.newPwd,callback:function(t){e.$set(e.password,"newPwd",t)},expression:"password.newPwd"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"确认密码：",prop:"confirmedNewPwd"}},[s("el-input",{staticStyle:{width:"300px",float:"right"},attrs:{placeholder:"请确认新密码",clearable:""},model:{value:e.password.confirmedNewPwd,callback:function(t){e.$set(e.password,"confirmedNewPwd",t)},expression:"password.confirmedNewPwd"}})],1)],1)],1)]],2),e._v(" "),s("div",{staticStyle:{width:"200px",margin:"auto","margin-top":"50px"}},[s("el-button",{on:{click:function(t){e.last()}}},[e._v("上一步")]),e._v(" "),s("el-button",{on:{click:function(t){e.next()}}},[e._v("下一步")])],1)]),e._v(" "),s("v-foot")],1)},staticRenderFns:[]};var a=s("vSla")(i,r,!1,function(e){s("bw0D")},"data-v-91f251be",null);t.default=a.exports},bw0D:function(e,t){}});
//# sourceMappingURL=8.e6cb50505815882df7e8.js.map