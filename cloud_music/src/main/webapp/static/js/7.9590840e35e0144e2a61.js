webpackJsonp([7],{RmVS:function(t,e){},ctj4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=s("3cXf"),o=s.n(l),i=s("Hn+D"),a=s("ANMl"),n=s("mx1b"),r={components:{vHead:i.a,vNav:a.a,vFoot:n.a},data:function(){return{id:"",style:["","POP 流行","ELECTRONIC 电子","ROCK 摇滚","CLASSIC 古典","FOLK 民谣","R&B","其他"],dialogVisible:!1,newPlaylist:{id:"",name:"",intro:"",type:"",info:""},rules:{name:[{required:!0,message:"请输入歌单名称",trigger:"blur"},{min:1,max:30,message:"长度在 1 到 30 个字符",trigger:"blur"}],intro:[{min:1,max:680,message:"长度在 680 个字符以内",trigger:"blur"}]},isOverflow:"",isLogin:"",album:{},songList:[],playlistList:[]}},methods:{indexMethod:function(t){return t+1},handleClose:function(t){this.$confirm("确认关闭？").then(function(e){t()}).catch(function(t){})},handleMouseEnter:function(t,e,s,l){t.Flag=!0},handleMouseOut:function(t,e,s,l){if(t.isopen)return!1;t.Flag=!1},handle:function(t,e){t.Flag=e,t.isopen=e},handleOverflow:function(){var t=document.getElementById("albumIntro").offsetHeight,e=document.getElementById("albumIntro").scrollHeight;this.isOverflow=t<e},playAllSong:function(){this.$store.dispatch("play",[this.songList,0,!1])},collect:function(){var t=this;this.isLogin?this.axios.get(this.serverUrl+"/user/likeAlbum",{params:{albumId:this.album.id}}).then(function(e){e?(t.state.likeAlbums.push(t.album),sessionStorage.setItem("likeAlbums",o()(t.state.likeAlbums)),t.album.isCollected=!0,t.$message({showClose:!0,message:"收藏专辑成功",type:"success"})):t.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)}):this.$confirm("还未登录,是否现在登录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){t.$router.push({path:"/user/unlogin"})}).catch(function(){})},cancelCollect:function(){var t=this;this.axios.get(this.serverUrl+"/user/unlikeAlbum",{params:{albumId:this.album.id}}).then(function(e){if(e){for(var s=0;s<t.state.likeAlbums.length;s++)if(t.state.likeAlbums[s].id==t.album.id){t.state.likeAlbums.splice(s,1);break}sessionStorage.setItem("likeAlbums",o()(t.state.likeAlbums)),t.album.isCollected=!1,t.$message({showClose:!0,message:"取消收藏成功",type:"success"})}else t.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})},handleAlbumCommand:function(t){"login"==t?this.$router.push({path:"/user/unlogin"}):"newplaylist"==t?(this.dialogVisible=!0,this.newPlaylist.type="album",this.newPlaylist.info=this.album.id):"playqueue"==t?this.$store.dispatch("addToSongList",this.songList):this.addAlbumToPlaylist(t.params)},addAlbumToPlaylist:function(t){var e=this;this.axios.get(this.serverUrl+"/playlist/addAlbum",{params:{albumId:this.album.id,playlistId:t}}).then(function(t){t?e.$message({showClose:!0,message:"已成功添加到歌单",type:"success"}):e.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})},playSong:function(t){this.$store.dispatch("play",[this.songList,t,!1])},collectSong:function(t){var e=this;this.axios.get(this.serverUrl+"/user/likeSong",{params:{songId:this.songList[t].id}}).then(function(s){s?(e.state.likeSongs.push(e.songList[t]),sessionStorage.setItem("likeSongs",o()(e.state.likeSongs)),e.$message({showClose:!0,message:"收藏歌曲成功",type:"success"})):e.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})},handleSongCommand:function(t){if("login"==t)this.$router.push({path:"/user/unlogin"});else if("playqueue"==t.type){var e=[this.songList[t.params]];this.$store.dispatch("addToSongList",e)}else"collect"==t.type?this.collectSong(t.params):"newplaylist"==t.type?(this.dialogVisible=!0,this.newPlaylist.type="song",this.newPlaylist.info=t.params.id):this.addSongToPlaylist(t.param2.id,t.param1)},addSongToPlaylist:function(t,e){var s=this;this.axios.get(this.serverUrl+"/playlist/addSong",{params:{songId:t,playlistId:e}}).then(function(t){t?s.$message({showClose:!0,message:"已成功添加到歌单",type:"success"}):s.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})},submitForm:function(){var t=this;this.$refs.newPlaylist.validate(function(e){if(!e)return t.$message({showClose:!0,message:"格式不正确",type:"error"}),!1;t.axios.post(t.serverUrl+"/playlist/create",{name:t.newPlaylist.name,intro:t.newPlaylist.intro}).then(function(e){if(-1!=e.data){var s={id:e.data,name:t.newPlaylist.name,intro:t.newPlaylist.intro};t.state.playlistList.push(s),sessionStorage.setItem("playlistList",o()(t.state.playlistList)),t.dialogVisible=!1,t.$refs.newPlaylist.resetFields(),t.$message({showClose:!0,message:"歌单创建成功",type:"success"}),"album"==t.newPlaylist.type?t.addAlbumToPlaylist(e.data):t.addSongToPlaylist(t.newPlaylist.info,e.data)}else t.$message({showClose:!0,message:"会话超时",type:"error"})}).catch(function(t){console.log(t)})})},downloadSong:function(t){var e=this;this.isLogin?window.location.href=this.serverUrl+"/download/downloadSong?id="+t.id:this.$confirm("还未登录,是否现在登录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){e.$router.push({path:"/user/unlogin"})}).catch(function(){})},timestampToTime:function(t){var e=new Date(t),s=e.getFullYear()+"-",l=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",o=e.getDate();return o<10&&(o="0"+o),s+l+o},getAlbumInfo:function(){var t=this;this.axios.get(this.serverUrl+"/album/getInfo",{params:{id:this.album.id}}).then(function(e){t.album=e.data,null==t.album.image?t.album.image=s("T0cg"):t.album.image=t.serverUrl+t.album.image,t.album.releaseDate=t.timestampToTime(t.album.releaseDate),t.album.style=t.style[t.album.style],t.songList=t.album.songList;for(var l=0;l<t.songList.length;l++)null==t.songList[l].image?t.songList[l].image=s("T0cg"):t.songList[l].image=t.serverUrl+t.songList[l].image,t.songList[l].filePath=t.serverUrl+t.songList[l].filePath,t.songList[l].lyricsPath=t.serverUrl+t.songList[l].lyricsPath,t.$set(t.songList[l],"Flag",!1),t.$set(t.songList[l],"isopen",!1);t.$set(t.album,"isCollected",!1),t.isLogin&&(t.getIsCollected(),t.getPlaylistList())}).catch(function(t){console.log(t)})},getPlaylistList:function(){if(!this.isLogin)return!1;this.playlistList=this.state.playlistList},getIsCollected:function(){for(var t=!1,e=0;e<this.state.likeAlbums.length;e++)if(this.album.id==this.state.likeAlbums[e].id){t=!0;break}this.album.isCollected=t}},created:function(){this.album.id=this.$route.query.id,window.scrollTo(0,0)},computed:{serverUrl:function(){return this.$store.state.serverUrl},state:function(){return this.$store.state}},mounted:function(){this.isLogin=this.state.isLogin,this.getAlbumInfo()},updated:function(){this.handleOverflow()}},c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wrapper"},[s("v-head"),t._v(" "),s("v-nav"),t._v(" "),s("div",{attrs:{id:"albumdetail",data:t.album}},[s("el-row",{staticStyle:{background:"linear-gradient(#F2F2F2, #FFFFFF)"},attrs:{gutter:50}},[s("el-col",{attrs:{span:4,offset:3}},[s("div",[s("img",{staticStyle:{width:"230px",height:"230px","margin-top":"20px"},attrs:{align:"right",src:t.album.image}})])]),t._v(" "),s("el-col",{attrs:{span:12}},[s("div",[s("p",{staticClass:"font_albumName",staticStyle:{"margin-bottom":"0px"}},[t._v(t._s(t.album.name))]),t._v(" "),s("i",{staticClass:"el-icon-service"}),t._v(" "),s("router-link",{attrs:{to:{path:"/user/artistdetail",query:{id:t.album.artistId}}}},[s("span",{staticClass:"font_albumArtistName",staticStyle:{color:"black",cursor:"pointer"},attrs:{onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='black';"}},[t._v(t._s(t.album.artistName))])]),t._v(" "),s("div",[s("p",{staticClass:"font_other"},[t._v("流派 : "+t._s(t.album.style))]),t._v(" "),s("p",{staticClass:"font_other"},[t._v("发行时间 : "+t._s(t.album.releaseDate))])]),t._v(" "),s("el-button",{staticStyle:{"background-color":"#31C27C"},attrs:{type:"primary",icon:"el-icon-caret-right",onmouseover:"this.style.backgroundColor='#2CAF6F';",onmouseout:"this.style.backgroundColor='#31C27C';"},on:{click:t.playAllSong}},[t._v("播放全部")]),t._v(" "),t.album.isCollected?s("el-button",{attrs:{icon:"el-icon-star-on"},on:{click:t.cancelCollect}},[t._v("已收藏")]):s("el-button",{attrs:{icon:"el-icon-star-off"},on:{click:t.collect}},[t._v("收藏")]),t._v(" "),s("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleAlbumCommand}},[s("el-button",{attrs:{icon:"el-icon-plus"}},[t._v("添加到"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown",data:t.playlistList},slot:"dropdown"},[s("el-dropdown-item",{attrs:{command:"playqueue"}},[t._v("播放队列")]),t._v(" "),t.isLogin?s("div",[t._l(t.playlistList,function(e){return s("el-dropdown-item",{key:e.id,attrs:{command:{type:"playlist",params:e.id}}},[t._v(t._s(e.name))])}),t._v(" "),s("el-dropdown-item",{attrs:{command:"newplaylist",divided:""}},[t._v("添加到新歌单")])],2):s("el-dropdown-item",{attrs:{command:"login",divided:""}},[t._v("登录后添加到歌单")])],1)],1)],1)])],1),t._v(" "),s("el-row",[s("el-col",{attrs:{span:16,offset:2}},[s("div",[s("el-table",{staticClass:"spHeight",staticStyle:{width:"95%"},attrs:{data:t.songList,stripe:!0},on:{"cell-mouse-enter":t.handleMouseEnter,"cell-mouse-leave":t.handleMouseOut}},[s("el-table-column",{attrs:{type:"index",label:" ",index:t.indexMethod}}),t._v(" "),s("el-table-column",{attrs:{label:"歌曲",width:"350"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("router-link",{attrs:{to:{path:"/user/songdetail",query:{id:e.row.id}}}},[s("span",{staticStyle:{color:"black",cursor:"pointer"},attrs:{onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='black';"}},[t._v(t._s(e.row.name))])])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:" ",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.Flag?s("span",[s("el-button",{attrs:{icon:"el-icon-caret-right",circle:""},on:{click:function(s){t.playSong(e.$index)}}})],1):t._e(),t._v(" "),e.row.Flag?s("span",[s("el-dropdown",{attrs:{trigger:"click",placement:"bottom-start"},on:{"visible-change":function(s){t.handle(e.row,s)},command:t.handleSongCommand}},[s("el-button",{attrs:{icon:"el-icon-plus",circle:""}}),t._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown",data:t.playlistList},slot:"dropdown"},[s("el-dropdown-item",{attrs:{command:{type:"playqueue",params:e.$index}}},[t._v("播放队列")]),t._v(" "),t.isLogin?s("div",[s("el-dropdown-item",{attrs:{divided:"",command:{type:"collect",params:e.$index}}},[t._v("我喜欢")]),t._v(" "),t._l(t.playlistList,function(l){return s("el-dropdown-item",{key:l.id,attrs:{command:{type:"playlist",param1:l.id,param2:e.row}}},[t._v(t._s(l.name))])}),t._v(" "),s("el-dropdown-item",{attrs:{command:{type:"newplaylist",params:e.row},divided:""}},[t._v("添加到新歌单")])],2):s("el-dropdown-item",{attrs:{command:"login",divided:""}},[t._v("登录后添加到歌单")])],1)],1)],1):t._e(),t._v(" "),e.row.Flag?s("span",[s("el-button",{attrs:{icon:"el-icon-download",circle:""},on:{click:function(s){t.downloadSong(e.row)}}})],1):t._e()]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"歌手",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("router-link",{attrs:{to:{path:"/user/artistdetail",query:{id:e.row.artistId}}}},[s("span",{staticStyle:{color:"black",cursor:"pointer"},attrs:{onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='black';"}},[t._v(t._s(e.row.artistName))])])]}}])}),t._v(" "),s("el-table-column",{attrs:{prop:"duration",label:"时长"}})],1)],1)]),t._v(" "),s("el-col",{attrs:{span:4}},[s("div",[t.album.intro?s("p",{staticClass:"font_albumIntro"},[t._v("简介")]):t._e(),t._v(" "),s("p",{staticClass:"font_other",staticStyle:{display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":"4",overflow:"hidden"},attrs:{id:"albumIntro"}},[t._v(t._s(t.album.intro))]),t._v(" "),this.isOverflow?s("el-popover",{attrs:{placement:"left",title:"专辑简介",trigger:"click",width:"500"}},[s("p",{staticClass:"font_other"},[t._v(t._s(t.album.intro))]),t._v(" "),s("el-button",{staticStyle:{color:"black"},attrs:{slot:"reference",type:"text",onmouseover:"this.style.color='#31C27C';",onmouseout:"this.style.color='black';"},slot:"reference"},[t._v("[更多]")])],1):t._e()],1)])],1),t._v(" "),s("el-dialog",{attrs:{title:"创建歌单",visible:t.dialogVisible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("el-form",{ref:"newPlaylist",attrs:{model:t.newPlaylist,rules:t.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"歌单名称",prop:"name"}},[s("el-input",{attrs:{placeholder:"请输入歌单名称"},model:{value:t.newPlaylist.name,callback:function(e){t.$set(t.newPlaylist,"name",e)},expression:"newPlaylist.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"歌单简介",prop:"intro"}},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入歌单简介"},model:{value:t.newPlaylist.intro,callback:function(e){t.$set(t.newPlaylist,"intro",e)},expression:"newPlaylist.intro"}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("完成")]),t._v(" "),s("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")])],1)],1)],1)],1),t._v(" "),s("v-foot")],1)},staticRenderFns:[]};var u=s("vSla")(r,c,!1,function(t){s("RmVS")},null,null);e.default=u.exports}});
//# sourceMappingURL=7.9590840e35e0144e2a61.js.map